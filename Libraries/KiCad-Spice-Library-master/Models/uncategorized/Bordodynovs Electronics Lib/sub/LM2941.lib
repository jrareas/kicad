.SUBCKT LM2941  IN ON_OFF GND_ ADJ   OUT 
Vkz1 GND_0 GND_ 0
Vkz2 GND_1 GND_ 0
R ADJ 0 1T
.PARAM  psrr=1.778e-4 uvlo=4.5 venb=2 ilim=1.9 pole=10k zero=100k rinp=1e7
+  ttrn=1e-4 rout=0.3 vref=1.275 ehys=1.2 uhys=0.05 drop=0.5

R_R6         N242982 VYY  10 TC=0,0 
C_U1_C2         0 U1_N05382  1n  
V_U1_V1         U1_N355970 0 {EHYS}
E_U1_ABM4         U1_N09035 0 VALUE { V(U1_N05348)  
+ * (ABS(V(VZZ)) + 1e-6)  
+ / (ABS(V(ADJ)) + 1e-6)  }
C_U1_C1         0 U1_N05348  {1e-6*SQRT(TTRN)} IC=0 
R_U1_R1         N235438 U1_N05348  1G  
V_U1_V2         U1_N356010 0 {VENB}
X_U1_U2         IN U1_N352510 U1_N3524503 U1_N13587 COMPHYS_BASIC_GEN PARAMS:
+  VDD=1 VSS=0 VTHRESH=0.5
E_U1_E1         U1_DROP 0 TABLE { V(LOAD, 0) } 
+ ( (0,0)
+  (100m,70m)(200m,90m)(300m,110m)(400m,100m)(500m,100m)(600m,120m)(800m,140m)(900m,170m)(1,200m)
+  )
X_U1_U3         U1_N3559262 EN_OK INV_BASIC_GEN PARAMS: VDD=1 VSS=0
+  VTHRESH=500E-3
V_U1_V3         U1_N3524503 0 {UHYS}
R_U1_R5         U1_N09745 N222524  10 TC=0,0 
V_U1_V4         U1_N352510 0 {UVLO}
R_U1_R3         DISCH U1_N05348  {3.333e5*SQRT(TTRN)} TC=0,0 
C_U1_C3         0 N222524  1n  
R_U1_R2         N235438 U1_N05382  1G  
E_U1_ABM6         DISCH 0 VALUE { IF(V(U1_N13587)> 0.6 & V(EN_OK) > 0.6, 
+ {VREF}, 0)    }
X_U1_U1         ON_OFF U1_N356010 U1_N355970 U1_N3559262 COMPHYS_BASIC_GEN
+  PARAMS: VDD=1 VSS=0 VTHRESH=0.5
E_U1_ABM5         U1_N09745 0 VALUE { MIN(V(U1_N05382),  
+ MAX(V(IN)-v(U1_DROP) , 0))   }
R_U1_R4         U1_N09035 U1_N05382  10 TC=0,0 
X_F1    N359447 VZZ IN VYY LM2941_F1 
C_C3         0 VYY  1n  
R_R5         N359447 VYY  {ROUT}  
E_ABM1         N242982 0 VALUE { {MIN(V(VXX), (V(Vzz)+(ILIM*ROUT)))}    }
R_R7         N235438 GND_0  1m TC=0,0 
X_S1    DISCH N235438 VZZ N235438 LM2941_S1 
R_R1         VXX IN  {RINP}  

R_R2         N222524 VXX  {PSRR*RINP}  
C_C1         VXX IN  {1/(6.28*RINP*POLE)}  
R_R11         N235438 DAP  1m TC=0,0 
 
E_ABM2         LOAD 0 VALUE { I(V_Vload)    }

C_C2         VXX N222524  {1/(6.28*PSRR*RINP*ZERO)}  
V_Vload         VZZ OUT 0Vdc
R_R8         N235438 GND_1  1m TC=0,0 

.subckt LM2941_F1 1 2 3 4  
F_F1         3 4 VF_F1 1
VF_F1         1 2 0V
.ends LM2941_F1
.subckt LM2941_S1 1 2 3 4  
S_S1         3 4 1 2 _S1
RS_S1         1 2 1G
.MODEL         _S1 VSWITCH Roff=120 Ron=1E9 Voff=0.24 Von=0.25
.ends LM2941_S1
.SUBCKT COMP_BASIC_GEN INP INM Y PARAMS: VDD=1 VSS=0 VTHRESH=0.5	
E_ABM Yint 0 VALUE {IF (V(INP) > 
+ V(INM), {VDD},{VSS})}
R1 Yint Y 1
C1 Y 0 1n
.ENDS COMP_BASIC_GEN
.SUBCKT COMPHYS_BASIC_GEN INP INM HYS OUT PARAMS: VDD=1 VSS=0 VTHRESH=0.5	
EIN INP1 INM1 INP INM 1 
EHYS INP1 INP2 VALUE { IF( V(1) > {VTHRESH},-V(HYS),0) }
EOUT OUT 0 VALUE { IF( V(INP2)>V(INM1), {VDD} ,{VSS}) }
R1 OUT 1 1
C1 1 0 5n
RINP1 INP1 0 1K
.ENDS COMPHYS_BASIC_GEN
.SUBCKT COMPHYS2_BASIC_GEN INP INM HYS OUT PARAMS: VDD=1 VSS=0 VTHRESH=0.5	
+ T=10
EIN INP1 INM1 INP INM 1 
EHYS INM2 INM1 VALUE { IF( V(1) > {VTHRESH},-V(HYS)/2,V(HYS)/2) }
EOUT OUT 0 VALUE { IF( V(INP1)>V(INM2), {VDD} ,{VSS}) }
R1 OUT 1 1
C1 1 0 {T*1e-9}
RINP1 INP1 0 10K
RINM2 INM2 0 10K
.ENDS COMPHYS2_BASIC_GEN
***********COMP**********
.SUBCKT D_D1 1 2
D1 1 2 DD1
.MODEL DD1 D( IS=1e-15 TT=10p Rs=0.05 N=.1  )
.ENDS D_D1
***********DIODE************
.SUBCKT INV_BASIC_GEN A  Y PARAMS: VDD=1 VSS=0 VTHRESH=0.5 
E_ABMGATE    YINT 0 VALUE {{IF(V(A) > {VTHRESH} , 
+ {VSS},{VDD})}}
RINT YINT Y 1
CINT Y 0 1n
.ENDS INV_BASIC_GEN
.ENDS LM2941
