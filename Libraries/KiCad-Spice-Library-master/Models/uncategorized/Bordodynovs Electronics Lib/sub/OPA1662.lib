*OPA1662 (PSpice Netlist Editor format) 
********************************************
*Green-Lis Macro-model Architecture
********************************************
**  This file was created by TINA      **
**    (c) 1996-2006 DesignSoft, Inc.   **
********************************************

* Rev A by Marek Lis;   December 20, 2011
*
*
* This macromodel has been optimized to model the AC, DC, noise, and transient response performance within 
* the device data sheet specified limits. Correct operation of this macromodel has been verified on DesignSoft
* TINA Version 7.0.80.224 SF. For help with other analog simulation software, please consult the software supplier.
*
*  
* Copyright 2011 by Texas Instruments Corporation

* BEGIN MODEL OPA166x

*GREEN-LIS MACRO-MODEL SIMULATED FEATURES:

*OPEN LOOP GAIN AND PHASE VS FREQUENCY WITH RL AND CL EFFECTS
*INPUT COMMON MODE REJECTION WITH FREQUENCY
*POWER SUPPLY REJECTION WITH FREQUENCY
*INPUT IMPEDANCE VS FREQUENCY 
*OUTPUT IMPEDANCE VS OUTPUT CURRENT
*INPUT VOLTAGE NOISE VS FREQUENCY
*INPUT CURRENT NOISE VS FREQUENCY 
*OUTPUT VOLTAGE SWING VS OUTPUT CURRENT
*SHORT-CIRCUIT OUTPUT CURRENT
*QUIESCENT CURRENT VS SUPPLY VOLTAGE
*SETTLING TIME VS CAPACITIVE LOAD
*SLEW RATE
*SMALL SIGNAL OVERSHOOT VS CAPACITIVE LOAD
*LARGE SIGNAL RESPONSE
*OVERLOAD RECOVERY TIME
*INPUT BIAS CURRENT
*INPUT VOLTAGE OFFSET
*INPUT COMMON MODE RANGE
*OUTPUT CURRENT COMING THROUGH THE SUPPLY RAILS


.SUBCKT OPA1662 -IN +IN V- V+ Vout
V12         10 48 500M
Vos         9 32 537.6U
V11         52 53 100M
V10         54 55 100M
V6          8 60 10
V5          61 8 10
V4          57 59 17
V1          58 56 17
V9          73 25 1
V8          77 V- 400M
V7          V+ 78 400M
IS2         V+ 9 600N
IS1         V+ V- 1.485M
IS3         44 V- -625N
V3          79 8 50
V2          8 80 50
C2          28 8  1.00000000000000E-0016 IC=0 
C1          21 8  1.00000000000000E-0016 IC=0 
L5          8 29 1.5M IC=0 
XR106       30 29 RNOISE_FREE_0
GVCCS3      8 30 31 8  1U
XIn12       32 33 FEMT_0
XVn11       34 32 VNSE_0
XVCVSPSRR   35 8 36 33 VCVS_LIMIT_0
L2          37 8 1F IC=0 
R9          37 35 1 
GVCCS8      8 35 8 38  1
C15         V+ V- 10P IC=0 
LPSR        39 8 20M IC=0 
RPSR        39 38 1 
GVCCS11     8 38 V+ V-  1U
XU15        22 8 40 41 VC_RES_0
L4          42 8 1F IC=0 
XU14        43 8 36 44 VCVS_LIMIT_1
L3          45 8 130U IC=0 
R11         42 43 1 
GVCCS2      8 43 8 46  1
RCM         45 46 1 
GVCCS7      8 46 9 8  2U
C3          24 8 15F IC=0 
XU13        10 47 IDEAL_D_0
EVCVS7      48 8 V- 8  1
R40         8 22 1K 
R39         8 22 1K 
R38         8 11 1K 
R37         8 12 1K 
ECS1        8 0 VALUE = {(V(V+,0)+V(V-,0))*0.5}
R32         15 8 1K 
R31         16 8 1K 
R30         15 8 1K 
R24         8 16 1K 
R15         49 8 1K 
R10         8 50 1K 
R8          8 13 100K 
R3          8 14 100K 
C22         8 17 1P IC=0 
R29         17 19 1 
C23         8 23 1P IC=0 
C9          51 8 10P IC=0 
R26         51 22 10 
C21         8 11 1P IC=0 
C20         8 12 1P IC=0 
C19         15 8 1P IC=0 
C17         16 8 1P IC=0 
C16         8 49 1P IC=0 
C12         50 8 1P IC=0 
R13         41 23 1 
SW14        14 13 11 8  S_VSWITCH_1
SW13        13 14 8 12  S_VSWITCH_2
R36         23 55 1M 
R35         23 53 1M 
SW12        56 52 15 8  S_VSWITCH_3
SW11        54 57 8 16  S_VSWITCH_4
R34         23 58 1K 
R33         23 59 1K 
SW10        61 19 17 8  S_VSWITCH_5
SW9         19 60 8 17  S_VSWITCH_6
R25         62 15 1 
R19         63 16 1 
R16         64 49 1 
R14         65 50 1 
R12         66 11 1 
R7          67 12 1 
R5          68 20 10M 
R6          69 19 10M 
R4          70 18 10M 
XR109       28 8 RNOISE_FREE_0
GVCCS1      8 28 21 8  1U
R28         20 8 1K 
R27         18 8 1K 
GIsinking   V- 8 71 8  1M
GIsourcing  V+ 8 72 8  1M
R23         71 8 10K 
SW7         22 71 51 8  S_VSWITCH_7
R21         8 72 10K 
SW8         22 72 51 8  S_VSWITCH_8
SW4         69 66 11 8  S_VSWITCH_9
SW3         67 69 8 12  S_VSWITCH_10
XU3         57 24 67 8 VCVS_LIMIT_2
XU1         56 24 66 8 VCVS_LIMIT_2
SW2         70 62 15 8  S_VSWITCH_11
SW1         63 70 8 16  S_VSWITCH_12
XU8         9 V+ IDEAL_D_1
XU12        V- 9 IDEAL_D_1
EVCVS6      73 8 V+ 8  1
R22         74 47 100 
EVCVS4      74 8 9 8  1
XU2         47 25 IDEAL_D_0
SW6         68 64 49 8  S_VSWITCH_13
SW5         65 68 8 50  S_VSWITCH_14
R2          26 8 1MEG 
R1          27 8 1MEG 
XU26        47 44 8 75 VCCS_LIMIT_0
XU4         75 8 8 19 VCCS_LIMIT_1
L1          8 76 4.5M IC=0 
XU24        8 22 26 77 VCVS_LIMIT_3
XU23        22 8 78 27 VCVS_LIMIT_4
XU22        79 22 63 8 VCVS_LIMIT_5
XU21        80 22 62 8 VCVS_LIMIT_5
XU20        26 Vout 64 8 VCVS_LIMIT_5
XU19        27 Vout 65 8 VCVS_LIMIT_6
XU11        V- 44 IDEAL_D_1
XU10        44 V+ IDEAL_D_1
XR109_2     81 8 RNOISE_FREE_0
GVCCS15     8 81 28 8  1U
GVCCS14     8 18 20 8  1M
GVCCS13     8 20 81 8  1M
XR108       21 8 RNOISE_FREE_0
GVCCS12     8 21 30 8  1U
R20         +IN 34 100 
R18         -IN 33 100 
XR106_2     31 76 RNOISE_FREE_0
GVCCS6      8 31 24 8  1U
XR105       24 8 RNOISE_FREE_0
XR104       19 8 RNOISE_FREE_1
XR103       8 75 RNOISE_FREE_0
CinpCM      34 8 2.5P IC=0 
CinnCM      8 33 2.5P IC=0 
C7          33 34 2P IC=0 
VCCVS1_in   40 Vout
HCCVS1      22 8 VCCVS1_in   1K
GVCCS5      8 24 19 8  1U
Ccc         19 8 350N IC=0 
EVCVS3      41 8 18 8  1
.MODEL S_VSWITCH_1 VSWITCH (RON=10 ROFF=100MEG VON=100M VOFF=-100M)
.MODEL S_VSWITCH_2 VSWITCH (RON=10 ROFF=100MEG VON=100M VOFF=-100M)
.MODEL S_VSWITCH_3 VSWITCH (RON=1 ROFF=10MEG VON=100M VOFF=-100M)
.MODEL S_VSWITCH_4 VSWITCH (RON=1 ROFF=10MEG VON=100M VOFF=-100M)
.MODEL S_VSWITCH_5 VSWITCH (RON=1 ROFF=100MEG VON=150 VOFF=0)
.MODEL S_VSWITCH_6 VSWITCH (RON=1 ROFF=100MEG VON=150 VOFF=0)
.MODEL S_VSWITCH_7 VSWITCH (RON=1M ROFF=10MEG VON=-10M VOFF=0)
.MODEL S_VSWITCH_8 VSWITCH (RON=1M ROFF=10MEG VON=10M VOFF=0)
.MODEL S_VSWITCH_9 VSWITCH (RON=1 ROFF=10MEG VON=1 VOFF=-1)
.MODEL S_VSWITCH_10 VSWITCH (RON=1 ROFF=10MEG VON=1 VOFF=-1)
.MODEL S_VSWITCH_11 VSWITCH (RON=1 ROFF=1G VON=10 VOFF=-10)
.MODEL S_VSWITCH_12 VSWITCH (RON=1 ROFF=1G VON=10 VOFF=-10)
.MODEL S_VSWITCH_13 VSWITCH (RON=1 ROFF=10MEG VON=10 VOFF=-10)
.MODEL S_VSWITCH_14 VSWITCH (RON=1 ROFF=10MEG VON=10 VOFF=-10)



* NOISELESS RESISTOR
.SUBCKT RNOISE_FREE_0  1 2
*ROHMS = VALUE IN OHMS OF NOISELESS RESISTOR
.PARAM ROHMS=1E6
ERES 1 3 VALUE = { I(VSENSE) * ROHMS }
RDUMMY 30 3 1
VSENSE 30 2 DC 0V
.ENDS RNOISE_FREE_0 


* BEGIN PROG NSE FEMTO AMP/RT-HZ 
.SUBCKT FEMT_0  1 2
* BEGIN SETUP OF NOISE GEN - FEMPTOAMPS/RT-HZ
* INPUT THREE VARIABLES
* SET UP INSE 1/F
* FA/RHZ AT 1/F FREQ
.PARAM NLFF=2E3
* FREQ FOR 1/F VAL
.PARAM FLWF=100
* SET UP INSE FB
* FA/RHZ FLATBAND
.PARAM NVRF=700
* END USER INPUT
* START CALC VALS
.PARAM GLFF={PWR(FLWF,0.25)*NLFF/1164}
.PARAM RNVF={1.184*PWR(NVRF,2)}
.MODEL DVNF D KF={PWR(FLWF,0.5)/1E11} IS=1.0E-16
* END CALC VALS
I1 0 7 10E-3
I2 0 8 10E-3
D1 7 0 DVNF
D2 8 0 DVNF
E1 3 6 7 8 {GLFF}
R1 3 0 1E9
R2 3 0 1E9
R3 3 6 1E9
E2 6 4 5 0 10
R4 5 0 {RNVF}
R5 5 0 {RNVF}
R6 3 4 1E9
R7 4 0 1E9
G1 1 2 3 4 1E-6
C1 1 0 1E-15
C2 2 0 1E-15
C3 1 2 1E-15
.ENDS
* END PROG NSE FEMTO AMP/RT-HZ


* BEGIN PROG NSE NANO VOLT/RT-HZ
.SUBCKT VNSE_0  1 2
* BEGIN SETUP OF NOISE GEN - NANOVOLT/RT-HZ
* INPUT THREE VARIABLES
* SET UP VNSE 1/F
* NV/RHZ AT 1/F FREQ
.PARAM NLF=4
* FREQ FOR 1/F VAL
.PARAM FLW=100
* SET UP VNSE FB
* NV/RHZ FLATBAND
.PARAM NVR=2.15
* END USER INPUT
* START CALC VALS
.PARAM GLF={PWR(FLW,0.25)*NLF/1164}
.PARAM RNV={1.184*PWR(NVR,2)}
.MODEL DVN D KF={PWR(FLW,0.5)/1E11} IS=1.0E-16
* END CALC VALS
I1 0 7 10E-3
I2 0 8 10E-3
D1 7 0 DVN
D2 8 0 DVN
E1 3 6 7 8 {GLF}
R1 3 0 1E9
R2 3 0 1E9
R3 3 6 1E9
E2 6 4 5 0 10
R4 5 0 {RNV}
R5 5 0 {RNV}
R6 3 4 1E9
R7 4 0 1E9
E3 1 2 3 4 1
C1 1 0 1E-15
C2 2 0 1E-15
C3 1 2 1E-15
.ENDS
* END PROG NSE NANOV/RT-HZ


*VOLTAGE CONTROLLED SOURCE WITH LIMITS
.SUBCKT VCVS_LIMIT_0  VC+ VC- VOUT+ VOUT-
*              
.PARAM GAIN = -1
.PARAM VPOS = 100M
.PARAM VNEG = -100M
E1 VOUT+ VOUT- VALUE={LIMIT(GAIN*V(VC+,VC-),VNEG,VPOS)}
.ENDS VCVS_LIMIT_0 


*VOLTAGE CONTROLLED RESISTOR
.SUBCKT VC_RES_0  1      2      3    4
*              VC+    VC-   RES1 RES2
*ERES 3 40 VALUE = {600*(I(VSENSE) /(1+ABS(V(1,2)))*0.075)}
ERES 3 40 VALUE = {40*(I(VSENSE) / SQRT(((ABS(V(1,2))/0.2)+1)/1))}
VSENSE 40 4 DC 0
.ENDS VC_RES_0 


*VOLTAGE CONTROLLED SOURCE WITH LIMITS
.SUBCKT VCVS_LIMIT_1  VC+ VC- VOUT+ VOUT-
*              
.PARAM GAIN = 1
.PARAM VPOS = 10M
.PARAM VNEG = -10M
E1 VOUT+ VOUT- VALUE={LIMIT(GAIN*V(VC+,VC-),VNEG,VPOS)}
.ENDS VCVS_LIMIT_1 


*TG IDEAL DIODE
.SUBCKT IDEAL_D_0  A C
D1 A C DNOM
.MODEL DNOM D (TT=10P CJO=1E-18 IS=1E-15 RS=1E-3)
.ENDS IDEAL_D_0 


*VOLTAGE CONTROLLED SOURCE WITH LIMITS
.SUBCKT VCVS_LIMIT_2  VC+ VC- VOUT+ VOUT-
*              
.PARAM GAIN = 100
.PARAM VPOS = 6000
.PARAM VNEG = -6000
E1 VOUT+ VOUT- VALUE={MAX(MIN(GAIN*V(VC+,VC-),VPOS),VNEG)}
.ENDS VCVS_LIMIT_2 


*TG IDEAL DIODE
.SUBCKT IDEAL_D_1  A C
D1 A C DNOM 
.MODEL DNOM D (TT=10P CJO=1E-18 IS=1E-15 RS=1E-3)
.ENDS IDEAL_D_1 


*VOLTAGE CONTROLLED SOURCE WITH LIMITS
.SUBCKT VCCS_LIMIT_0  VC+ VC- IOUT+ IOUT-
*              
.PARAM GAIN = 50U
*.PARAM GAIN = 1M
.PARAM IPOS = .5
.PARAM INEG = -.5
G1 IOUT+ IOUT- VALUE={MAX(MIN(GAIN*V(VC+,VC-),IPOS),INEG)}
.ENDS VCCS_LIMIT_0 


*VOLTAGE CONTROLLED SOURCE WITH LIMITS
.SUBCKT VCCS_LIMIT_1  VC+ VC- IOUT+ IOUT-
*              
.PARAM GAIN = 1
.PARAM IPOS = 6
.PARAM INEG = -6
G1 IOUT+ IOUT- VALUE={MAX(MIN(GAIN*V(VC+,VC-),IPOS),INEG)}
.ENDS VCCS_LIMIT_1 


*VOLTAGE CONTROLLED SOURCE WITH LIMITS
.SUBCKT VCVS_LIMIT_3  VC+ VC- VOUT+ VOUT-
*              
.PARAM GAIN = 40M
.PARAM VPOS = 6
.PARAM VNEG = 0
E1 VOUT+ VOUT- VALUE={MIN(MAX(GAIN*V(VC+,VC-),VNEG),VPOS)}
.ENDS VCVS_LIMIT_3 


*VOLTAGE CONTROLLED SOURCE WITH LIMITS
.SUBCKT VCVS_LIMIT_4  VC+ VC- VOUT+ VOUT-
*              
.PARAM GAIN = 40M
.PARAM VPOS = 5
.PARAM VNEG = 0
E1 VOUT+ VOUT- VALUE={MIN(MAX(GAIN*V(VC+,VC-),VNEG),VPOS)}
.ENDS VCVS_LIMIT_4 


*VOLTAGE CONTROLLED SOURCE WITH LIMITS
.SUBCKT VCVS_LIMIT_5  VC+ VC- VOUT+ VOUT-
*              
.PARAM GAIN = 100
.PARAM VPOS = 5000
.PARAM VNEG = -5000
E1 VOUT+ VOUT- VALUE={MAX(MIN(GAIN*V(VC+,VC-),VPOS),VNEG)}
.ENDS VCVS_LIMIT_5 


*VOLTAGE CONTROLLED SOURCE WITH LIMITS
.SUBCKT VCVS_LIMIT_6  VC+ VC- VOUT+ VOUT-
*             
.PARAM GAIN = 100
.PARAM VPOS = 5000
.PARAM VNEG = -5000
E1 VOUT+ VOUT- VALUE={MAX(MIN(GAIN*V(VC+,VC-),VPOS),VNEG)}
.ENDS VCVS_LIMIT_6 


* NOISELESS RESISTOR
.SUBCKT RNOISE_FREE_1  1 2
*ROHMS = VALUE IN OHMS OF NOISELESS RESISTOR
.PARAM ROHMS=1E4
ERES 1 3 VALUE = { I(VSENSE) * ROHMS }
RDUMMY 30 3 1
VSENSE 30 2 DC 0V
.ENDS RNOISE_FREE_1 
.ENDS

